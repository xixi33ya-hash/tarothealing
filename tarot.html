<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”ç½—ä¸å¿ƒçµç–—æ„ˆ - è¿æ¥ä¸œè¥¿æ–¹æ™ºæ…§çš„çµæ€§ä¹‹æ—…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Serif SC', serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f7e6 0%, #e0f0e9 50%, #d1e8e2 100%);
            color: #2c514c;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body:before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M20,20 C40,10 60,10 80,20 C90,40 90,60 80,80 C60,90 40,90 20,80 C10,60 10,40 20,20 Z" fill="none" stroke="%23a3c9b8" stroke-width="0.5" opacity="0.3"/></svg>');
            opacity: 0.15;
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #a3c9b8;
            position: relative;
            overflow: hidden;
        }
        
        header:after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #4a8e7f, #63a995);
        }
        
        h1 {
            font-size: 3rem;
            color: #3a7a6d;
            margin-bottom: 15px;
            font-weight: 400;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #5a8a7e;
            font-weight: 300;
            margin-bottom: 20px;
        }
        
        .tagline {
            font-style: italic;
            color: #7a9c91;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .user-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .main-content {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .card-section, .chat-section, .resources-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #a3c9b8;
            position: relative;
            overflow: hidden;
        }
        
        .card-section:before, .chat-section:before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 0 C70 0 90 20 90 50 C90 80 70 100 50 100 C20 100 0 80 0 50 C0 20 20 0 50 0 Z" fill="%23d1e8e2" opacity="0.5"/></svg>') no-repeat;
            background-size: contain;
            opacity: 0.3;
            z-index: 0;
        }
        
        h2 {
            color: #3a7a6d;
            font-size: 2rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #b8d5c7;
            font-weight: 400;
            position: relative;
        }
        
        h2:after {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(to right, #4a8e7f, #63a995);
        }
        
        .card-display {
            text-align: center;
            margin: 25px 0;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .tarot-card {
            width: 200px;
            height: 320px;
            background: linear-gradient(135deg, #d6e9e1 0%, #c5ded3 100%);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
            border: 2px solid #9bc1b3;
            transform-style: preserve-3d;
        }
        
        .tarot-card:before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="100" height="100" fill="none" stroke="%239bc1b3" stroke-width="2" stroke-dasharray="10,10"/></svg>');
            opacity: 0.2;
        }
        
        .tarot-card:hover {
            transform: translateY(-8px) rotateY(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .card-icon {
            font-size: 4.5rem;
            color: #4a8e7f;
            transition: all 0.5s ease;
        }
        
        .tarot-card:hover .card-icon {
            transform: scale(1.1);
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
        .top-navigation a:hover {
            background: rgba(74, 142, 127, 0.1) !important;
            color: #2c514c !important;
            transform: translateY(-1px);
        }
        
        .top-navigation a.active {
            background: linear-gradient(135deg, #4a8e7f 0%, #63a995 100%) !important;
            color: white !important;
        }
        
        @media (max-width: 768px) {
            .top-navigation ul {
                gap: 20px !important;
            }
            .top-navigation a {
                font-size: 1rem !important;
                padding: 6px 12px !important;
            }
        }
        
        @media (max-width: 480px) {
            .top-navigation ul {
                gap: 10px !important;
                flex-direction: column;
            }
            .top-navigation a {
                font-size: 0.9rem !important;
                padding: 8px 12px !important;
                width: 100%;
                justify-content: center;
            }
        }
        
        .card-name {
            font-size: 1.8rem;
            color: #3a7a6d;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .card-description {
            color: #5a8a7e;
            font-size: 1.1rem;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        .btn {
            background: linear-gradient(to right, #4a8e7f, #63a995);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(74, 142, 127, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background: linear-gradient(to right, #3a7a6d, #4a8e7f);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .btn:hover:before {
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 142, 127, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #a3c9b8, #b8d5c7);
            color: #2c514c;
        }
        
        .btn-secondary:before {
            background: linear-gradient(to right, #93b9a8, #a3c9b8);
        }
        
        .button-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, #e6c973, #d4af37);
            color: #5a4a00;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(180, 160, 60, 0.3);
        }
        
        .spread-options {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .spread-option {
            padding: 10px 20px;
            background: rgba(163, 201, 184, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .spread-option.active {
            background: linear-gradient(to right, #4a8e7f, #63a995);
            color: white;
        }
        
        .tarot-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .mini-card {
            width: 70px;
            height: 100px;
            background: linear-gradient(135deg, #d6e9e1 0%, #c5ded3 100%);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #9bc1b3;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mini-card:hover {
            transform: translateY(-5px) rotate(5deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(240, 247, 230, 0.6);
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 400px;
            border: 1px solid #d1e8e2;
        }
        
        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(to right, #4a8e7f, #63a995);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.95);
            color: #2c514c;
            border-bottom-left-radius: 5px;
            border: 1px solid #d1e8e2;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chat-input {
            display: flex;
            gap: 15px;
        }
        
        input {
            flex: 1;
            padding: 15px 20px;
            border: 1px solid #b8d5c7;
            border-radius: 30px;
            font-size: 1.1rem;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        input:focus {
            border-color: #4a8e7f;
            box-shadow: 0 0 0 3px rgba(74, 142, 127, 0.2);
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .resource-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #a3c9b8;
            transition: all 0.3s ease;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .resource-card h3 {
            color: #3a7a6d;
            margin-bottom: 10px;
        }
        
        .resource-card p {
            color: #5a8a7e;
            margin-bottom: 15px;
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #b8d5c7, transparent);
            margin: 25px 0;
        }
        
        .quote {
            font-style: italic;
            text-align: center;
            color: #5a8a7e;
            margin: 25px 0;
            padding: 0 20px;
            font-size: 1.1rem;
            position: relative;
        }
        
        .quote:before, .quote:after {
            content: '"';
            font-size: 3rem;
            color: #a3c9b8;
            position: absolute;
            opacity: 0.5;
        }
        
        .quote:before {
            top: -20px;
            left: 0;
        }
        
        .quote:after {
            bottom: -40px;
            right: 0;
            transform: rotate(180deg);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 15px;
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-content form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-content input {
            padding: 12px 15px;
            border: 1px solid #b8d5c7;
            border-radius: 25px;
            font-size: 1rem;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: #5a8a7e;
            font-size: 1rem;
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border: 1px solid #a3c9b8;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .tarot-card {
                width: 180px;
                height: 280px;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
            }
            
            .user-actions {
                position: static;
                justify-content: center;
                margin-top: 20px;
            }
        }
        
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }
        
        .floating-element:nth-child(1) {
            top: 10%;
            left: 5%;
            font-size: 2rem;
            animation-duration: 25s;
        }
        
        .floating-element:nth-child(2) {
            top: 20%;
            right: 10%;
            font-size: 1.5rem;
            animation-duration: 20s;
            animation-delay: -5s;
        }
        
        .floating-element:nth-child(3) {
            bottom: 30%;
            left: 15%;
            font-size: 2.2rem;
            animation-duration: 30s;
            animation-delay: -10s;
        }
        
        .floating-element:nth-child(4) {
            bottom: 20%;
            right: 5%;
            font-size: 1.8rem;
            animation-duration: 22s;
            animation-delay: -15s;
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="floating-element">â˜¯</div>
        <div class="floating-element">ğŸŒ¸</div>
        <div class="floating-element">ğŸƒ</div>
        <div class="floating-element">ğŸŒ™</div>
    </div>
    
    <div class="container">
        <header>
            <h1>å¡”ç½—ä¸å¿ƒçµç–—æ„ˆ <i class="fas fa-leaf"></i></h1>
            <p class="subtitle">è¿æ¥ä¸œè¥¿æ–¹æ™ºæ…§çš„çµæ€§ä¹‹æ—… Â· ä¸æ½œæ„è¯†å¯¹è¯</p>
            <p class="tagline">"å¡”ç½—ä¸æ˜¯é¢„æµ‹æœªæ¥çš„æ°´æ™¶çƒï¼Œè€Œæ˜¯æ˜ ç…§å†…å¿ƒä¸–ç•Œçš„å¿ƒçµé•œå­"</p>
            
            <div class="user-actions">
                <button id="loginBtn" class="btn btn-secondary">ç™»å½•</button>
                <button id="registerBtn" class="btn">æ³¨å†Œ</button>
            </div>
        </header>
        
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="top-navigation" style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 15px 30px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); border: 1px solid #a3c9b8;">
            <ul style="list-style: none; padding: 0; margin: 0; display: flex; justify-content: center; align-items: center; gap: 40px; flex-wrap: wrap;">
                <li><a href="index.html" style="text-decoration: none; color: #3a7a6d; font-size: 1.1rem; font-weight: 500; padding: 8px 16px; border-radius: 10px; transition: all 0.3s ease; display: flex; align-items: center;"><i class="fas fa-home" style="margin-right: 6px;"></i>é¦–é¡µ</a></li>
                <li><a href="index.html#shangshangqian" style="text-decoration: none; color: #3a7a6d; font-size: 1.1rem; font-weight: 500; padding: 8px 16px; border-radius: 10px; transition: all 0.3s ease; display: flex; align-items: center;"><i class="fas fa-ticket-alt" style="margin-right: 6px;"></i>ä¸Šä¸Šç­¾</a></li>
                <li><a href="../company_name.html" style="text-decoration: none; color: #3a7a6d; font-size: 1.1rem; font-weight: 500; padding: 8px 16px; border-radius: 10px; transition: all 0.3s ease; display: flex; align-items: center;"><i class="fas fa-building" style="margin-right: 6px;"></i>å…¬å¸æµ‹å</a></li>
                <li><a href="index.html#baby-naming" style="text-decoration: none; color: #3a7a6d; font-size: 1.1rem; font-weight: 500; padding: 8px 16px; border-radius: 10px; transition: all 0.3s ease; display: flex; align-items: center;"><i class="fas fa-baby" style="margin-right: 6px;"></i>å®å®èµ·å</a></li>
                <li><a href="#" class="active" style="text-decoration: none; color: white; font-size: 1.1rem; font-weight: 500; padding: 8px 16px; border-radius: 10px; transition: all 0.3s ease; display: flex; align-items: center; background: linear-gradient(135deg, #4a8e7f 0%, #63a995 100%);"><i class="fas fa-moon" style="margin-right: 6px;"></i>å¡”ç½—ç‰Œ</a></li>
            </ul>
        </nav>
        
        <div class="main-content">
            <section class="card-section">
                <h2>å¡”ç½—ç‰ŒæŠ½å– <i class="fas fa-cards"></i></h2>
                <p>æŠ½ä¸€å¼ å¡”ç½—ç‰Œï¼Œè·å–å³æ—¶çš„çµæ€§æŒ‡å¼•å’Œåˆæ­¥åˆ†æã€‚è§£é”æ·±åº¦æŠ¥å‘Šå¯è·å¾—å®Œæ•´è§£è¯»å’Œä¸ªæ€§åŒ–å»ºè®®ã€‚</p>
                
                <div class="card-display">
                    <div class="tarot-card">
                        <div class="card-icon">
                            <i class="fas fa-question"></i>
                        </div>
                    </div>
                    <p class="card-name">ç­‰å¾…æŠ½å–</p>
                    <p class="card-description">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŠ½å–ä¸€å¼ å¡”ç½—ç‰Œï¼Œè·å–ä»Šæ—¥æŒ‡å¼•ã€‚</p>
                </div>
                
                <div class="button-group">
                    <button class="btn" id="drawCard">
                        <i class="fas fa-random"></i> æŠ½å–å¡”ç½—ç‰Œ
                    </button>
                    <button class="btn btn-secondary" id="buyReport">
                        <i class="fas fa-unlock"></i> è§£é”æ·±åº¦æŠ¥å‘Š <span class="premium-badge">é«˜çº§</span>
                    </button>
                    <button class="btn btn-secondary" id="shareReading">
                        <i class="fas fa-share-alt"></i> åˆ†äº«è§£è¯»
                    </button>
                </div>
                
                <div class="divider"></div>
                
                <h3>ç‰Œé˜µé€‰æ‹©</h3>
                <div class="spread-options">
                    <div class="spread-option active" data-spread="single">å•å¼ ç‰Œ</div>
                    <div class="spread-option" data-spread="three">ä¸‰ç‰Œé˜µ</div>
                    <div class="spread-option" data-spread="celtic">å‡¯å°”ç‰¹åå­—</div>
                </div>
                
                <div class="tarot-cards">
                    <div class="mini-card">è¿‡å»</div>
                    <div class="mini-card">ç°åœ¨</div>
                    <div class="mini-card">æœªæ¥</div>
                </div>
                <p>å°è¯•ä½¿ç”¨æ—¶é—´ä¹‹æµç‰Œé˜µï¼Œäº†è§£é—®é¢˜çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥å‘å±•è¶‹åŠ¿ã€‚</p>
            </section>
            
            <section class="chat-section">
                <h2>å¡”ç½—ç–—æ„ˆå¸ˆå’¨è¯¢ <i class="fas fa-comments"></i></h2>
                <p>å‘æˆ‘ä»¬çš„AIå¡”ç½—ç–—æ„ˆå¸ˆæé—®ï¼Œè·å–èåˆä¸œæ–¹æ™ºæ…§çš„ä¸ªæ€§åŒ–æŒ‡å¯¼ã€‚</p>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai-message">
                        ğŸŒ¸ ä½ å¥½ï¼Œäº²çˆ±çš„æœ‹å‹ï¼Œæˆ‘æ˜¯æ…§å¿ƒã€‚åœ¨è¿™ä¸ªå……æ»¡å˜åŒ–çš„ä¸–ç•Œé‡Œï¼Œæˆ‘åœ¨è¿™é‡Œé™ªä¼´ä½ æ¢ç´¢å¿ƒçµçš„æ·±åº¦ã€‚æˆ‘èåˆäº†å¡”ç½—çš„å¤è€æ™ºæ…§å’Œä¸œæ–¹å“²å­¦çš„æ¸©æŸ”æ•™å¯¼ï¼Œæ„¿æ„å’Œä½ ä¸€èµ·åœ¨ç”Ÿå‘½çš„æ—…ç¨‹ä¸­å¯»æ‰¾å…‰æ˜å’Œå¹³é™ã€‚
                        <br><br>
                        åœ¨è¿™é‡Œï¼Œæ²¡æœ‰åˆ¤æ–­ï¼Œåªæœ‰ç†è§£ï¼›æ²¡æœ‰æŒ‡è´£ï¼Œåªæœ‰é™ªä¼´ã€‚è¯·æ”¾å¿ƒåœ°åˆ†äº«ä½ çš„å¿ƒå£°ï¼Œæ— è®ºæ˜¯ç„¦è™‘ã€å›°æƒ‘ï¼Œè¿˜æ˜¯å¿«ä¹å’Œæ¢¦æƒ³â€”â€”æ¯ä¸€ç§æƒ…æ„Ÿéƒ½å€¼å¾—è¢«æ¸©æŸ”ä»¥å¾…ã€‚ ğŸŒ¿
                    </div>
                </div>
                
                <!-- å¿«é€Ÿå›å¤æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜...">
                    <button class="btn" id="sendMessage">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- å¯¹è¯ç®¡ç†åŠŸèƒ½ -->
                <div class="chat-management" style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" id="viewHistoryBtn" style="background: rgba(163, 201, 184, 0.6); font-size: 0.9rem; padding: 8px 16px;">
                        <i class="fas fa-history"></i> æŸ¥çœ‹å†å²
                    </button>
                    <button class="btn btn-secondary" id="clearHistoryBtn" style="background: rgba(200, 100, 100, 0.6); font-size: 0.9rem; padding: 8px 16px;">
                        <i class="fas fa-trash"></i> æ¸…ç©ºè®°å½•
                    </button>
                    <button class="btn btn-secondary" id="exportChatBtn" style="background: rgba(74, 142, 127, 0.6); font-size: 0.9rem; padding: 8px 16px;">
                        <i class="fas fa-download"></i> å¯¼å‡ºå¯¹è¯
                    </button>
                </div>
                
                <div class="divider"></div>
                
                <div class="quote">
                    "çœŸæ­£çš„å¡”ç½—å¤§å¸ˆï¼Œéƒ½æ˜¯å°†ä¹¦æœ¬çŸ¥è¯†ä¸å†…åœ¨æ™ºæ…§å®Œç¾ç»“åˆçš„äººã€‚"
                </div>
            </section>
        </div>
        
        <section class="resources-section">
            <h2>å¡”ç½—å­¦ä¹ èµ„æº <i class="fas fa-book"></i></h2>
            <div class="resources-grid">
                <div class="resource-card">
                    <h3>å¡”ç½—åŸºç¡€</h3>
                    <p>äº†è§£å¡”ç½—ç‰Œçš„åŸºæœ¬ç»“æ„å’Œå«ä¹‰ï¼Œå¼€å§‹ä½ çš„å¡”ç½—ä¹‹æ—…ã€‚</p>
                    <button class="btn" id="tarotBasicsBtn">é˜…è¯»æ›´å¤š</button>
                </div>
                <div class="resource-card">
                    <h3>ç‰Œé˜µæŒ‡å—</h3>
                    <p>å­¦ä¹ å„ç§ç‰Œé˜µçš„ä½¿ç”¨æ–¹æ³•å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
                    <button class="btn" onclick="window.location.href='tarot_play.html'">é˜…è¯»æ›´å¤š</button>
                </div>
                <div class="resource-card">
                    <h3>ä¸œæ–¹æ™ºæ…§ä¸å¡”ç½—</h3>
                    <p>æ¢ç´¢å¡”ç½—ä¸æ˜“ç»ã€é“å®¶æ€æƒ³ç­‰ä¸œæ–¹æ™ºæ…§çš„å…±é€šä¹‹å¤„ã€‚</p>
                    <button class="btn">é˜…è¯»æ›´å¤š</button>
                </div>
            </div>
        </section>
        
        <footer>
            <p>Â© 2025 å¡”ç½—ä¸å¿ƒçµç–—æ„ˆ Â· æœ¬ç½‘ç«™å†…å®¹ä»…ä¾›å¨±ä¹å’Œè‡ªæˆ‘æ¢ç´¢ä½¿ç”¨</p>
            <p>èåˆä¸œæ–¹æ™ºæ…§ä¸ç°ä»£å¿ƒç†å­¦è§†è§’çš„å¡”ç½—è§£è¯»</p>
        </footer>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">ç™»å½•</h2>
            <form id="authForm">
                <input type="email" id="email" placeholder="é‚®ç®±" required>
                <input type="password" id="password" placeholder="å¯†ç " required>
                <button type="submit" class="btn">æäº¤</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å¡”ç½—åŸºç¡€é˜…è¯»æ›´å¤šæŒ‰é’®äº‹ä»¶
            document.getElementById('tarotBasicsBtn')?.addEventListener('click', function() {
                    window.location.href = 'tarot_cards.html';
                });
            // å¡”ç½—ç‰Œæ•°æ®
            const tarotCards = [
                { 
                    name: "æ„šè€…", 
                    icon: "fas fa-hat-cowboy",
                    description: "æ–°çš„å¼€å§‹ï¼Œæ— é™å¯èƒ½ã€‚ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼Œä¿¡ä»»ç”Ÿå‘½çš„æ—…ç¨‹ã€‚",
                    fullDescription: "æ„šè€…ç‰Œä»£è¡¨æ–°çš„å¼€å§‹ã€å†’é™©å’Œç²¾ç¥è‡ªç”±ã€‚å®ƒé¼“åŠ±ä½ ä»¥å¤©çœŸå’Œå¼€æ”¾çš„å¿ƒæ€è¿æ¥æ–°çš„ä½“éªŒï¼Œä¸è¦è¢«è¿‡å»çš„ç»éªŒé™åˆ¶ã€‚åœ¨ä¸œæ–¹æ™ºæ…§ä¸­ï¼Œè¿™ä¸é“å®¶çš„'æ— ä¸º'æ€æƒ³ç›¸é€šï¼Œæé†’æˆ‘ä»¬é¡ºåº”è‡ªç„¶ï¼Œä¸åˆ»æ„å¼ºæ±‚ã€‚"
                },
                { 
                    name: "é­”æœ¯å¸ˆ", 
                    icon: "fas fa-hat-wizard",
                    description: "è¿ç”¨ä½ çš„èµ„æºå’ŒæŠ€èƒ½ï¼Œå°†æƒ³æ³•è½¬åŒ–ä¸ºç°å®ã€‚ä½ æœ‰åˆ›é€ å¥‡è¿¹çš„èƒ½åŠ›ã€‚",
                    fullDescription: "é­”æœ¯å¸ˆç‰Œè±¡å¾ç€åˆ›é€ åŠ›ã€æŠ€èƒ½å’Œå°†æƒ³æ³•å˜ä¸ºç°å®çš„èƒ½åŠ›ã€‚ä½ æ‹¥æœ‰æ‰€éœ€çš„ä¸€åˆ‡èµ„æºï¼Œåªéœ€è¦æ­£ç¡®è¿ç”¨å®ƒä»¬ã€‚è¿™ä¸å„’å®¶'çŸ¥è¡Œåˆä¸€'çš„ç†å¿µç›¸å‘¼åº”ï¼Œå¼ºè°ƒå°†çŸ¥è¯†è½¬åŒ–ä¸ºè¡ŒåŠ¨çš„é‡è¦æ€§ã€‚"
                },
                { 
                    name: "å¥³ç¥­å¸", 
                    icon: "fas fa-moon",
                    description: "å€¾å¬ä½ å†…å¿ƒçš„å£°éŸ³å’Œç›´è§‰ã€‚ç­”æ¡ˆä¸åœ¨å¤–é¢ï¼Œè€Œåœ¨ä½ çš„å†…å¿ƒæ·±å¤„ã€‚",
                    fullDescription: "å¥³ç¥­å¸ä»£è¡¨ç›´è§‰ã€æ½œæ„è¯†æ™ºæ…§å’Œå†…åœ¨çŸ¥è¯†ã€‚å¥¹é¼“åŠ±ä½ å€¾å¬å†…å¿ƒçš„å£°éŸ³ï¼Œè€Œä¸æ˜¯ä¾èµ–å¤–éƒ¨æ„è§ã€‚è¿™ä¸ä½›å®¶'é™åå†…è§‚'çš„ä¿®è¡Œæ–¹å¼ç›¸é€šï¼Œæé†’æˆ‘ä»¬åœ¨é™é»˜ä¸­å¯»æ‰¾æ™ºæ…§ã€‚"
                },
                { 
                    name: "çš‡å", 
                    icon: "fas fa-crown",
                    description: "ä¸°ç››ã€æ»‹å…»å’Œåˆ›é€ åŠ›çš„æ—¶æœŸã€‚ä¸è‡ªç„¶è¿æ¥ï¼Œäº«å—ç”Ÿå‘½çš„é¦ˆèµ ã€‚",
                    fullDescription: "çš‡åç‰Œè±¡å¾ç€ä¸°ç››ã€æ»‹å…»å’Œåˆ›é€ åŠ›ã€‚å¥¹ä»£è¡¨ä¸å¤§è‡ªç„¶çš„è¿æ¥å’Œç”Ÿå‘½çš„ä¸°é¥¶ã€‚åœ¨ä¸œæ–¹æ™ºæ…§ä¸­ï¼Œè¿™ä¸é“å®¶'é“æ³•è‡ªç„¶'å’Œã€Šæ˜“ç»ã€‹'åšå¾·è½½ç‰©'çš„æ€æƒ³ç›¸å‘¼åº”ï¼Œæé†’æˆ‘ä»¬æ¥çº³å¹¶åˆ›é€ ç”Ÿæ´»ä¸­çš„ç¾å¥½ã€‚"
                },
                { 
                    name: "çš‡å¸", 
                    icon: "fas fa-crown",
                    description: "å»ºç«‹ç»“æ„å’Œç§©åºçš„æ—¶å€™ã€‚è¿ç”¨é€»è¾‘å’Œæƒå¨æ¥è¾¾æˆç›®æ ‡ã€‚",
                    fullDescription: "çš‡å¸ç‰Œä»£è¡¨ç»“æ„ã€ç§©åºå’Œæƒå¨ã€‚ä»–é¼“åŠ±ä½ å»ºç«‹æ¸…æ™°çš„ç•Œé™å¹¶ä¸ºè‡ªå·±çš„ç”Ÿæ´»è´Ÿè´£ã€‚è¿™ä¸å„’å®¶'ä»å¾·æ²»å›½'å’Œ'å›å­ä¹‹é“'çš„ç†æƒ³ç›¸ç¬¦ï¼Œå¼ºè°ƒé€šè¿‡ç†æ€§å’Œå†³æ–­åŠ›æ¥å»ºç«‹ç¨³å®šå’Œå®‰å…¨ã€‚"
                }
            ];
            
            // æ™ºèƒ½AIç–—æ„ˆå¸ˆç³»ç»Ÿï¼ˆå¢å¼ºç‰ˆï¼‰
            const aiTherapist = {
                // å¯¹è¯å†å²
                conversationHistory: [],
                
                // ç”¨æˆ·æƒ…ç»ªçŠ¶æ€è¿½è¸ª
                userMoodState: 'neutral',
                
                // ç–—æ„ˆå¸ˆäººæ ¼ç‰¹è´¨
                personality: {
                    name: 'æ…§å¿ƒ',
                    style: 'gentle_wise', // æ¸©æŸ”æ™ºæ…§å‹
                    greeting: ['äº²çˆ±çš„æœ‹å‹', 'æ¸©æŸ”çš„çµé­‚', 'å¿ƒçˆ±çš„å­©å­', 'æˆ‘çš„æœ‹å‹', 'å–„è‰¯çš„ä½ '],
                    empathy: ['æˆ‘ç†è§£ä½ çš„æ„Ÿå—', 'æˆ‘èƒ½æ„Ÿå—åˆ°ä½ å†…å¿ƒçš„', 'ä½ çš„å¿ƒæƒ…æˆ‘å®Œå…¨ç†è§£', 'è¿™ç§æ„Ÿè§‰æˆ‘å¾ˆç†è§£']
                },
                
                // ç”¨æˆ·åå¥½å­¦ä¹ 
                userPreferences: {
                    favoriteTopics: [],
                    communicationStyle: 'gentle', // é»˜è®¤æ¸©æŸ”é£æ ¼
                    wisdomSource: 'mixed'
                },
                
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç”¨æˆ·æ•°æ®
                loadUserData: function() {
                    const savedData = localStorage.getItem('tarotTherapistData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        this.conversationHistory = data.conversationHistory || [];
                        this.userPreferences = {...this.userPreferences, ...data.userPreferences};
                    }
                },
                
                // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
                saveUserData: function() {
                    const dataToSave = {
                        conversationHistory: this.conversationHistory.slice(-50), // åªä¿å­˜æœ€è¿‘50æ¡å¯¹è¯
                        userPreferences: this.userPreferences
                    };
                    localStorage.setItem('tarotTherapistData', JSON.stringify(dataToSave));
                },
                
                // å­¦ä¹ ç”¨æˆ·åå¥½
                learnFromInteraction: function(userMessage, aiResponse) {
                    // åˆ†æç”¨æˆ·å…³æ³¨çš„ä¸»é¢˜
                    const topics = this.extractTopics(userMessage);
                    topics.forEach(topic => {
                        if (!this.userPreferences.favoriteTopics.includes(topic)) {
                            this.userPreferences.favoriteTopics.push(topic);
                        }
                    });
                    
                    // åˆ†ææ²Ÿé€šé£æ ¼åå¥½
                    if (/ç›´æ¥|ç®€å•|å¿«é€Ÿ/.test(userMessage)) {
                        this.userPreferences.communicationStyle = 'direct';
                    } else if (/æ¸©æŸ”|è€å¿ƒ|æ…°è—‰/.test(userMessage)) {
                        this.userPreferences.communicationStyle = 'gentle';
                    }
                    
                    // åˆ†ææ™ºæ…§æºåå¥½
                    if (/ä¸œæ–¹|ä¸­å›½|ä¼ ç»Ÿ|æ˜“ç»|ä½›|é“/.test(userMessage)) {
                        this.userPreferences.wisdomSource = 'eastern';
                    }
                    
                    this.saveUserData();
                },
                
                // æå–ä¸»é¢˜å…³é”®è¯
                extractTopics: function(message) {
                    const topics = [];
                    if (/å·¥ä½œ|äº‹ä¸š|èŒä¸š/.test(message)) topics.push('career');
                    if (/çˆ±æƒ…|æ„Ÿæƒ…|æ‹çˆ±/.test(message)) topics.push('love');
                    if (/é‡‘é’±|è´¢å¯Œ|è´¢è¿/.test(message)) topics.push('finance');
                    if (/å¥åº·|èº«ä½“/.test(message)) topics.push('health');
                    if (/å®¶åº­|äº²æƒ…/.test(message)) topics.push('family');
                    return topics;
                },
                
                // å…³é”®è¯æ˜ å°„å’Œæ™ºèƒ½å›å¤
                keywordResponses: {
                    // æƒ…æ„Ÿç±»å…³é”®è¯
                    emotions: {
                        'ç„¦è™‘|æ‹…å¿ƒ|ç´§å¼ |ææƒ§|å®³æ€•|ä¸å®‰|å¿ƒæ…Œ|ææ…Œ': {
                            cards: ['éšå£«', 'æ˜Ÿæ˜Ÿ', 'å¤ªé˜³', 'èŠ‚åˆ¶', 'å¥³ç¥­å¸'],
                            responses: [
                                "äº²çˆ±çš„ï¼Œæˆ‘èƒ½æ„Ÿå—åˆ°ä½ å†…å¿ƒçš„ä¸å®‰ï¼Œå°±åƒå¤œç©ºä¸­è¿·è·¯çš„å°é¸Ÿã€‚è®©æˆ‘ä»¬ä¸€èµ·å¯»æ‰¾é‚£é¢—æŒ‡å¼•çš„æ˜Ÿæ˜Ÿå§ã€‚éšå£«ç‰Œå‘Šè¯‰æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™ç­”æ¡ˆå°±åœ¨å®‰é™çš„å†…çœä¸­ã€‚ä¸å¦¨æ¯å¤©ç»™è‡ªå·±ç•™10åˆ†é’Ÿçš„é™å¿ƒæ—¶å…‰ï¼Œæ„Ÿå—å†…åœ¨çš„å®é™ã€‚",
                                "æ¸©æŸ”çš„çµé­‚ï¼Œç„¦è™‘å¾€å¾€æ˜¯å› ä¸ºæˆ‘ä»¬å¤ªå…³å¿ƒæœªæ¥çš„ä¸ç¡®å®šæ€§ã€‚æ˜Ÿæ˜Ÿç‰Œè±¡å¾ç€å¸Œæœ›å’ŒæŒ‡å¼•ï¼Œæé†’æˆ‘ä»¬å³ä½¿åœ¨æœ€é»‘æš—çš„å¤œæ™šï¼Œä¹Ÿæœ‰å…‰èŠ’ä¸ºæˆ‘ä»¬ç…§äº®å‰è·¯ã€‚æ·±å‘¼å¸ï¼Œå°†æ³¨æ„åŠ›å›åˆ°å½“ä¸‹è¿™ä¸€åˆ»ï¼Œæ„Ÿå—è‡ªå·±çš„å¿ƒè·³ï¼Œä½ æ¯”æƒ³è±¡ä¸­æ›´åšå¼ºã€‚",
                                "æˆ‘çš„æœ‹å‹ï¼Œå¤ªé˜³ç‰Œå¸¦æ¥æ¸©æš–çš„æ‹¥æŠ±ï¼Œå‘Šè¯‰æˆ‘ä»¬æ¯ä¸€ä¸ªé»æ˜éƒ½å¸¦ç€æ–°çš„å¸Œæœ›ã€‚å½“ææƒ§è¢­æ¥æ—¶ï¼Œè¯•ç€æƒ³è±¡è‡ªå·±è¢«æ¸©æš–çš„é˜³å…‰åŒ…å›´ï¼Œé‚£ä»½å…‰æ˜å°±åœ¨ä½ çš„å†…å¿ƒæ·±å¤„ï¼Œä»æœªç¦»å¼€è¿‡ã€‚"
                            ]
                        },
                        'å¼€å¿ƒ|å¿«ä¹|é«˜å…´|å…´å¥‹|å–œæ‚¦|æ»¡æ„|æ¬£å–œ|æ„‰å¿«': {
                            cards: ['å¤ªé˜³', 'ä¸–ç•Œ', 'åœ£æ¯ä¸‰', 'æ˜Ÿå¸å'],
                            responses: [
                                "å¤šä¹ˆç¾å¥½çš„èƒ½é‡ï¼ä½ çš„å–œæ‚¦å¦‚åŒå¤ªé˜³ç‰Œä¸€æ ·æ¸©æš–æ˜äº®ï¼Œç…§äº®äº†å‘¨å›´çš„æ¯ä¸€ä¸ªè§’è½ã€‚è¿™ç§æ­£é¢çš„èƒ½é‡æ˜¯çè´µçš„ç¤¼ç‰©ï¼Œè¯·å¥½å¥½çæƒœè¿™ä¸ªç¾å¥½çš„æ—¶åˆ»ï¼Œè®©å®ƒæˆä¸ºä½ ç”Ÿå‘½ä¸­æ¸©æš–çš„è®°å¿†ã€‚",
                                "çœ‹åˆ°ä½ çš„å¿«ä¹ï¼Œæˆ‘çš„å¿ƒä¹Ÿè·Ÿç€æ¸©æš–èµ·æ¥ã€‚ä¸–ç•Œç‰Œä»£è¡¨ç€å®Œæ•´å’Œæ»¡è¶³ï¼Œä½ ç°åœ¨çš„çŠ¶æ€æ­£æ˜¯è¿™æ ·çš„åœ†æ»¡ã€‚è¿™ç§å–œæ‚¦ä¸ä»…æ»‹å…»ç€ä½ ï¼Œä¹Ÿä¼šåƒæ¶Ÿæ¼ªä¸€æ ·ä¼ é€’ç»™èº«è¾¹çš„äººã€‚",
                                "ä½ çš„å¿«ä¹å¦‚åŒåœ£æ¯ä¸‰ä¸€æ ·ï¼Œå……æ»¡äº†åº†ç¥å’Œåˆ†äº«çš„èƒ½é‡ã€‚å–œæ‚¦æ˜¯å¿ƒçµæœ€å¥½çš„è‰¯è¯ï¼Œå»ºè®®ä½ å°†è¿™ä»½ç¾å¥½ä¸æ‰€çˆ±çš„äººåˆ†äº«ï¼Œè®©çˆ±åœ¨åˆ†äº«ä¸­å€å¢ã€‚"
                            ]
                        },
                        'è¿·èŒ«|å›°æƒ‘|ä¸çŸ¥é“|ä¸ç¡®å®š': {
                            cards: ['æ„šè€…', 'æœˆäº®', 'å‘½è¿ä¹‹è½®'],
                            responses: [
                                "è¿·èŒ«æ˜¯æˆé•¿è·¯ä¸Šçš„å¿…ç»ä¹‹è·¯ã€‚æ„šè€…ç‰Œæé†’æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™ä¸çŸ¥é“æ–¹å‘åè€Œæ˜¯æ–°å¼€å§‹çš„ä¿¡å·ã€‚ç›¸ä¿¡è‡ªå·±çš„ç›´è§‰ï¼Œå‹‡æ•¢è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‚",
                                "æœˆäº®ç‰Œåæ˜ äº†æ‚¨å†…å¿ƒçš„ä¸ç¡®å®šæ„Ÿã€‚è¿™å¼ ç‰Œå‘Šè¯‰æˆ‘ä»¬ï¼Œè¿·é›¾ç»ˆä¼šæ•£å»ï¼ŒçœŸç›¸ä¼šåœ¨åˆé€‚çš„æ—¶å€™æ˜¾ç°ã€‚",
                                "å›°æƒ‘æ—¶æœŸå¾€å¾€é¢„ç¤ºç€è½¬å˜çš„åˆ°æ¥ã€‚å‘½è¿ä¹‹è½®æé†’æˆ‘ä»¬ï¼Œç”Ÿå‘½æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å…¶æ„ä¹‰ã€‚"
                            ]
                        }
                    },
                    
                    // ç”Ÿæ´»é¢†åŸŸå…³é”®è¯
                    lifeAreas: {
                        'å·¥ä½œ|äº‹ä¸š|èŒä¸š|ä¸Šç­|åŒäº‹|è€æ¿|å‡èŒ|åŠ è–ª|è·³æ§½': {
                            cards: ['çš‡å¸', 'æˆ˜è½¦', 'é’±å¸å', 'æƒæ–ä¸‰', 'é’±å¸å…«'],
                            responses: [
                                "äº²çˆ±çš„ï¼Œå…³äºäº‹ä¸šçš„å‘å±•ï¼Œçš‡å¸ç‰Œå¸¦æ¥çš„æ™ºæ…§æ˜¯ï¼šçœŸæ­£çš„é¢†å¯¼åŠ›æ¥è‡ªäºå†…åœ¨çš„ç¨³å®šå’Œè‡ªä¿¡ã€‚å»ºè®®ä½ å…ˆç†æ¸…è‡ªå·±çš„ä»·å€¼è§‚å’Œç›®æ ‡ï¼Œç„¶åç”¨ç†æ€§å’Œæ™ºæ…§æ¥åˆ¶å®šå®ç°è®¡åˆ’ã€‚è®°ä½ï¼Œæ¯ä¸€æ­¥å®åœ°çš„åŠªåŠ›éƒ½åœ¨ä¸ºä½ çš„æ¢¦æƒ³é“ºè·¯ã€‚",
                                "æ¸©æŸ”çš„çµé­‚ï¼Œæˆ˜è½¦ç‰Œè±¡å¾ç€åœ¨èŒåœºä¸Šçš„å‰è¿›åŠ¨åŠ›ã€‚ä½†çœŸæ­£çš„æˆåŠŸä¸åœ¨äºç›²ç›®åœ°å¥”è·‘ï¼Œè€Œåœ¨äºæ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚å»ºè®®ä½ ä¿æŒä¸“æ³¨å’Œå†³å¿ƒï¼ŒåŒæ—¶ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±çš„èº«å¿ƒå¥åº·ã€‚å·¥ä½œåªæ˜¯ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯å…¨éƒ¨ã€‚",
                                "æˆ‘çš„æœ‹å‹ï¼Œé’±å¸åä»£è¡¨ç€äº‹ä¸šçš„ç¨³å®šå’Œä¸°æ”¶ã€‚è¿™æé†’æˆ‘ä»¬ï¼ŒçœŸæ­£çš„æˆå°±éœ€è¦æ—¶é—´çš„ç§¯ç´¯ã€‚ä¸è¦æ€¥äºæ±‚æˆï¼Œæ¯ä¸€å¤©çš„å°è¿›æ­¥éƒ½åœ¨ä¸ºæœªæ¥çš„å¤§æˆå°±åšå‡†å¤‡ã€‚è€—å¿ƒä¸€ç‚¹ï¼Œè®©æ—¶é—´æˆä¸ºä½ çš„ç›Ÿå‹ã€‚"
                            ]
                        },
                        'çˆ±æƒ…|æ„Ÿæƒ…|æ‹çˆ±|å…³ç³»|ç”·å‹|å¥³å‹|è€å…¬|è€å©†|ç»“å©š|åˆ†æ‰‹': {
                            cards: ['æ‹äºº', 'åœ£æ¯äºŒ', 'çš‡å', 'åœ£æ¯å›½ç‹', 'åœ£æ¯å…­'],
                            responses: [
                                "å¿ƒçˆ±çš„å­©å­ï¼Œæ‹äººç‰Œæ•™å¯¼æˆ‘ä»¬çˆ±æƒ…çš„çœŸè°›ï¼šçœŸæ­£çš„çˆ±æƒ…æ˜¯ä¸¤ä¸ªå®Œæ•´çš„çµé­‚çš„é‡è§ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªç¼ºå¤±çš„äººçš„ä¾èµ–ã€‚åœ¨å…³ç³»ä¸­ä¿æŒçœŸè¯šå’Œå¼€æ”¾ï¼Œå…è®¸å¯¹æ–¹çœ‹åˆ°çœŸå®çš„ä½ ï¼Œä¹Ÿè¦å‹‡æ•¢åœ°å»äº†è§£çœŸå®çš„ä»–/å¥¹ã€‚",
                                "äº²çˆ±çš„ï¼Œåœ£æ¯äºŒåƒä¸¤ä¸ªäººåœ¨æ°´è¾¹çš„æ·±åº¦äº¤æµï¼Œè±¡å¾ç€å¥åº·çš„æƒ…æ„Ÿè¿æ¥ã€‚çœŸæ­£çš„äº²å¯†å…³ç³»éœ€è¦æƒ…æ„Ÿçš„æŠ•å…¥å’Œç›¸äº’çš„ç†è§£ã€‚å»ºè®®ä½ åœ¨å…³ç³»ä¸­å¤šä¸€äº›å€¾å¬å’Œå…±æƒ…ï¼Œå°‘ä¸€äº›åˆ¤æ–­å’ŒæŒ‡è´£ã€‚",
                                "æ¸©æŸ”çš„æœ‹å‹ï¼Œçš‡åç‰Œæé†’æˆ‘ä»¬ï¼Œçˆ±ä¸è¢«çˆ±éƒ½éœ€è¦æ™ºæ…§ã€‚åœ¨æ„Ÿæƒ…ä¸­å­¦ä¼šæ—¢ç»™äºˆä¹Ÿæ¥å—ï¼Œç”¨æ¸©æŸ”å’Œè€å¿ƒæ»‹å…»è¿™ä»½çè´µçš„æƒ…æ„Ÿã€‚è®°ä½ï¼Œæœ€å¥½çš„çˆ±æƒ…æ˜¯è®©å½¼æ­¤éƒ½æˆä¸ºæ›´å¥½çš„è‡ªå·±ã€‚"
                            ]
                        },
                        'é‡‘é’±|è´¢å¯Œ|è´¢è¿|ç»æµ': {
                            cards: ['é’±å¸å›½ç‹', 'é’±å¸å››', 'å‘½è¿ä¹‹è½®'],
                            responses: [
                                "é’±å¸å›½ç‹æé†’æˆ‘ä»¬ï¼ŒçœŸæ­£çš„è´¢å¯Œæ¥è‡ªäºæ™ºæ…§çš„ç®¡ç†å’Œé•¿æœŸçš„æŠ•èµ„ã€‚è¦å­¦ä¼šç†è´¢å’ŒèŠ‚åˆ¶ã€‚",
                                "é’±å¸å››è±¡å¾ç€å¯¹ç‰©è´¨çš„è¿‡åº¦æ‰§ç€ã€‚å»ºè®®æ‚¨åœ¨è¿½æ±‚è´¢å¯Œçš„åŒæ—¶ï¼Œä¸è¦å¿½ç•¥ç²¾ç¥å±‚é¢çš„å¯Œè¶³ã€‚",
                                "è´¢è¿å¦‚å‘½è¿ä¹‹è½®èˆ¬èµ·ä¼å˜åŒ–ã€‚ä¿æŒå¹³å’Œçš„å¿ƒæ€ï¼Œæœºä¼šæ€»ä¼šåœ¨åˆé€‚çš„æ—¶å€™åˆ°æ¥ã€‚"
                            ]
                        }
                    },
                    
                    // ä¸œæ–¹æ™ºæ…§å…³é”®è¯
                    easternWisdom: {
                        'æ˜“ç»|å…«å¦|é˜´é˜³|äº”è¡Œ': [
                            "ã€Šæ˜“ç»ã€‹å‘Šè¯‰æˆ‘ä»¬'ç©·åˆ™å˜ï¼Œå˜åˆ™é€šï¼Œé€šåˆ™ä¹…'ã€‚å¡”ç½—ç‰Œä¸æ˜“ç»æœ‰ç€ç›¸ä¼¼çš„æ™ºæ…§â€”â€”éƒ½æ˜¯é€šè¿‡ç¬¦å·æ¥è§£è¯»ç”Ÿå‘½çš„å¥¥ç§˜ã€‚",
                            "é˜´é˜³å¹³è¡¡æ˜¯å®‡å®™çš„æ ¹æœ¬æ³•åˆ™ã€‚åœ¨å¡”ç½—ä¸­ï¼Œæ¯å¼ ç‰Œéƒ½æœ‰å…‰æ˜å’Œé˜´å½±é¢ï¼Œå¦‚åŒé˜´é˜³äº’è¡¥ã€‚",
                            "äº”è¡Œç›¸ç”Ÿç›¸å…‹çš„é“ç†åœ¨å¡”ç½—å››å¤§èŠ±è‰²ä¸­ä¹Ÿæœ‰ä½“ç°ï¼šåœ£æ¯ï¼ˆæ°´ï¼‰ã€æƒæ–ï¼ˆç«ï¼‰ã€é’±å¸ï¼ˆåœŸï¼‰ã€å®å‰‘ï¼ˆé‡‘ï¼‰ã€‚"
                        ],
                        'ä½›|ç¦…|å†¥æƒ³|é™å¿ƒ': [
                            "ä½›å®¶è®²'å¿ƒé™è‡ªç„¶å‡‰'ï¼Œå¡”ç½—è§£è¯»ä¹Ÿéœ€è¦å¹³é™çš„å¿ƒå¢ƒã€‚å»ºè®®æ‚¨åœ¨æŠ½ç‰Œå‰å…ˆé™å¿ƒå†¥æƒ³ã€‚",
                            "ç¦…çš„æ™ºæ…§åœ¨äºæ´»åœ¨å½“ä¸‹ã€‚å¡”ç½—ç‰Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒåæ˜ çš„æ˜¯å½“ä¸‹çš„èƒ½é‡çŠ¶æ€ï¼Œè€Œéå›ºå®šçš„å‘½è¿ã€‚",
                            "å†¥æƒ³æ˜¯ä¸å†…åœ¨æ™ºæ…§å¯¹è¯çš„æ–¹å¼ã€‚æ¯æ¬¡å¡”ç½—è§£è¯»å‰ï¼Œä¸å¦¨å…ˆå†¥æƒ³å‡ åˆ†é’Ÿï¼Œè®©å¿ƒå½’äºå®é™ã€‚"
                        ],
                        'é“|è€å­|é“å¾·ç»|æ— ä¸º': [
                            "è€å­è¯´'é“æ³•è‡ªç„¶'ï¼Œå¡”ç½—ä¹Ÿæ•™å¯¼æˆ‘ä»¬é¡ºåº”è‡ªç„¶è§„å¾‹ï¼Œè€Œéå¼ºæ±‚ã€‚",
                            "'æ— ä¸ºè€Œæ²»'çš„æ™ºæ…§åœ¨äºçŸ¥é“ä½•æ—¶è¡ŒåŠ¨ï¼Œä½•æ—¶ç­‰å¾…ã€‚æ„šè€…ç‰Œä½“ç°äº†è¿™ç§é¡ºå…¶è‡ªç„¶çš„æ€åº¦ã€‚",
                            "ã€Šé“å¾·ç»ã€‹äº‘'çŸ¥è€…ä¸è¨€ï¼Œè¨€è€…ä¸çŸ¥'ã€‚çœŸæ­£çš„æ™ºæ…§å¾€å¾€æ¥è‡ªå†…å¿ƒçš„ç›´è§‰ï¼Œè€Œéå¤–åœ¨çš„çŸ¥è¯†ã€‚"
                        ]
                    }
                },
                
                // æ™ºèƒ½å›å¤ç”Ÿæˆ
                generateResponse: function(userMessage) {
                    const message = userMessage.toLowerCase();
                    const timestamp = Date.now();
                    
                    // æ£€æµ‹æƒ…ç»ªçŠ¶æ€
                    this.detectMood(message);
                    
                    // å…³é”®è¯åŒ¹é…
                    let response = this.matchKeywords(message);
                    
                    if (!response) {
                        response = this.getContextualResponse();
                    }
                    
                    // æ ¹æ®ç”¨æˆ·åå¥½è°ƒæ•´å›å¤é£æ ¼
                    response = this.adjustResponseStyle(response);
                    
                    // è®°å½•å¯¹è¯å¹¶å­¦ä¹ 
                    this.conversationHistory.push({
                        user: userMessage, 
                        ai: response, 
                        timestamp: timestamp,
                        mood: this.userMoodState
                    });
                    
                    this.learnFromInteraction(userMessage, response);
                    
                    return response;
                },
                
                // æ ¹æ®ç”¨æˆ·åå¥½è°ƒæ•´å›å¤é£æ ¼ï¼ˆæ›´æ¸©æŸ”ç‰ˆï¼‰
                adjustResponseStyle: function(response) {
                    const greeting = this.personality.greeting[Math.floor(Math.random() * this.personality.greeting.length)];
                    const empathy = this.personality.empathy[Math.floor(Math.random() * this.personality.empathy.length)];
                    
                    if (this.userPreferences.communicationStyle === 'gentle' || this.userMoodState === 'sad' || this.userMoodState === 'anxious') {
                        // æ¸©æŸ”é£æ ¼ï¼šæ·»åŠ æ›´å¤šæƒ…æ„Ÿå…³æ€€
                        const gentlePrefixes = [
                            `${greeting}ï¼Œ${empathy}ã€‚`,
                            `è®©æˆ‘è½»è½»æŠ±ä¸€ä¸‹ä½ çš„å¿ƒæƒ…ã€‚`,
                            `æˆ‘åœ¨è¿™é‡Œé™ªç€ä½ ï¼Œä¸ç”¨æ€¥ã€‚`,
                            `æ„Ÿå—åˆ°ä½ çš„å‹‡æ•¢ï¼Œæ„¿æ„åˆ†äº«è¿™äº›ã€‚`
                        ];
                        const prefix = gentlePrefixes[Math.floor(Math.random() * gentlePrefixes.length)];
                        return prefix + " " + response;
                    } else if (this.userPreferences.communicationStyle === 'direct') {
                        // ç›´æ¥é£æ ¼ï¼šç®€æ´æ˜äº†ä½†ä»ç„¶æ¸©æš–
                        return response.replace(/æ‚¨å¯ä»¥|å»ºè®®æ‚¨|ä¸å¦¨/g, '').trim();
                    }
                    
                    // é»˜è®¤æ¸©æŸ”é£æ ¼
                    return `${greeting}ï¼Œ` + response;
                },
                
                // æƒ…ç»ªæ£€æµ‹ï¼ˆå¢å¼ºç‰ˆï¼‰
                detectMood: function(message) {
                    // å¤åˆæƒ…ç»ªæ£€æµ‹
                    const emotionScores = {
                        anxious: 0,
                        happy: 0,
                        confused: 0,
                        sad: 0,
                        angry: 0,
                        hopeful: 0
                    };
                    
                    // ç„¦è™‘ç›¸å…³è¯æ±‡
                    if (/ç„¦è™‘|æ‹…å¿ƒ|ç´§å¼ |ææƒ§|å®³æ€•|ä¸å®‰|å¿ƒæ‚¸|ææ…Œ|æ¶å¿ƒ/.test(message)) {
                        emotionScores.anxious += 2;
                    }
                    if (/ä¼šä¸ä¼š|æ€ä¹ˆåŠ|å¦‚æœ|ä¸‡ä¸€/.test(message)) {
                        emotionScores.anxious += 1;
                    }
                    
                    // å¿«ä¹ç›¸å…³è¯æ±‡
                    if (/å¼€å¿ƒ|å¿«ä¹|é«˜å…´|å…´å¥‹|å–œæ‚¦|æ»¡æ„|æ£’|å¤ªå¥½äº†|æ„Ÿè°¢/.test(message)) {
                        emotionScores.happy += 2;
                    }
                    
                    // è¿·èŒ«ç›¸å…³è¯æ±‡
                    if (/è¿·èŒ«|å›°æƒ‘|ä¸çŸ¥é“|ä¸ç¡®å®š|ç–‘æƒ‘|é€‰æ‹©|å†³å®š/.test(message)) {
                        emotionScores.confused += 2;
                    }
                    
                    // æ‚²ä¼¤ç›¸å…³è¯æ±‡
                    if (/éš¾è¿‡|ä¼¤å¿ƒ|ç—›è‹¦|æ²®ä¸§|éƒé—·|ç»æœ›|å¤±æœ›|å­¤å•/.test(message)) {
                        emotionScores.sad += 2;
                    }
                    
                    // æ„¤æ€’ç›¸å…³è¯æ±‡
                    if (/ç”Ÿæ°”|æ„¤æ€’|çƒ¦èº|ä¸å…¬å¹³|ä¸æ»¡|è®¨åŒ|æ²¡ç”¨/.test(message)) {
                        emotionScores.angry += 2;
                    }
                    
                    // å¸Œæœ›ç›¸å…³è¯æ±‡
                    if (/å¸Œæœ›|æœŸå¾…|æƒ³è¦|æ‰“ç®—|è®¡åˆ’|æ¢¦æƒ³|ç›®æ ‡/.test(message)) {
                        emotionScores.hopeful += 2;
                    }
                    
                    // æ‰¾åˆ°æœ€é«˜åˆ†æ•°çš„æƒ…ç»ª
                    let maxScore = 0;
                    let dominantMood = 'neutral';
                    
                    for (let mood in emotionScores) {
                        if (emotionScores[mood] > maxScore) {
                            maxScore = emotionScores[mood];
                            dominantMood = mood;
                        }
                    }
                    
                    this.userMoodState = dominantMood;
                },
                
                // å…³é”®è¯åŒ¹é…
                matchKeywords: function(message) {
                    // æ£€æŸ¥æƒ…æ„Ÿå…³é”®è¯
                    for (let pattern in this.keywordResponses.emotions) {
                        if (new RegExp(pattern).test(message)) {
                            const category = this.keywordResponses.emotions[pattern];
                            const randomResponse = category.responses[Math.floor(Math.random() * category.responses.length)];
                            return randomResponse;
                        }
                    }
                    
                    // æ£€æŸ¥ç”Ÿæ´»é¢†åŸŸå…³é”®è¯
                    for (let pattern in this.keywordResponses.lifeAreas) {
                        if (new RegExp(pattern).test(message)) {
                            const category = this.keywordResponses.lifeAreas[pattern];
                            const randomResponse = category.responses[Math.floor(Math.random() * category.responses.length)];
                            return randomResponse;
                        }
                    }
                    
                    // æ£€æŸ¥ä¸œæ–¹æ™ºæ…§å…³é”®è¯
                    for (let pattern in this.keywordResponses.easternWisdom) {
                        if (new RegExp(pattern).test(message)) {
                            const responses = this.keywordResponses.easternWisdom[pattern];
                            return responses[Math.floor(Math.random() * responses.length)];
                        }
                    }
                    
                    return null;
                },
                
                // ä¸Šä¸‹æ–‡æ„ŸçŸ¥å›å¤ï¼ˆå¢å¼ºç‰ˆï¼‰
                getContextualResponse: function() {
                    // åˆ†æå¯¹è¯å†å²ä¸­çš„æ¨¡å¼
                    let contextualInsight = "";
                    
                    if (this.conversationHistory.length > 2) {
                        const recentMoods = this.conversationHistory.slice(-3).map(conv => conv.mood);
                        
                        // æ£€æµ‹æƒ…ç»ªè¶‹åŠ¿
                        if (recentMoods.filter(mood => mood === 'anxious').length >= 2) {
                            contextualInsight = "æˆ‘æ³¨æ„åˆ°æ‚¨æœ€è¿‘æœ‰äº›ç„¦è™‘ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä¸€äº›ç¼“è§£çš„æ–¹æ³•ã€‚";
                        } else if (recentMoods.includes('sad') && recentMoods.includes('confused')) {
                            contextualInsight = "æ‚¨ä¼¼ä¹æ­£åœ¨ç»å†ä¸€ä¸ªæƒ…æ„Ÿä¸Šæ¯”è¾ƒå›°éš¾çš„æ—¶æœŸã€‚è®°ä½ï¼Œè¿™æ˜¯æˆé•¿çš„æœºä¼šã€‚";
                        }
                    }
                    
                    const baseResponses = [
                        "ä»å¡”ç½—çš„è§†è§’çœ‹ï¼Œæ‚¨å½“å‰çš„æƒ…å†µåæ˜ äº†å†…åœ¨éœ€è¦å¹³è¡¡çš„éƒ¨åˆ†ã€‚èƒ½å¦å‘Šè¯‰æˆ‘æ›´å¤šå…³äºæ‚¨ç°åœ¨é¢ä¸´çš„å…·ä½“æƒ…å†µï¼Ÿ",
                        "æ¯ä¸ªäººçš„ç”Ÿå‘½æ—…ç¨‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„èŠ‚å¥ã€‚æ‚¨ç°åœ¨æœ€å…³å¿ƒçš„æ˜¯å“ªä¸ªæ–¹é¢çš„é—®é¢˜å‘¢ï¼Ÿ",
                        "å¡”ç½—ç‰Œå¦‚åŒä¸€é¢å¿ƒçµä¹‹é•œï¼Œåæ˜ çš„æ˜¯æˆ‘ä»¬å†…åœ¨çš„çŠ¶æ€ã€‚è¯·åˆ†äº«æ›´å¤šæ‚¨çš„æ„Ÿå—ï¼Œè®©æˆ‘ä¸ºæ‚¨æä¾›æ›´ç²¾å‡†çš„æŒ‡å¼•ã€‚",
                        "åœ¨ä¸œæ–¹æ™ºæ…§ä¸­ï¼Œä¸‡äº‹ä¸‡ç‰©éƒ½æœ‰å…¶å› æœè”ç³»ã€‚æ‚¨æåˆ°çš„æƒ…å†µï¼Œæ˜¯å¦æœ‰ä»€ä¹ˆç‰¹åˆ«çš„èƒŒæ™¯æˆ–è§¦å‘äº‹ä»¶ï¼Ÿ",
                        "çœŸæ­£çš„æ™ºæ…§æ¥è‡ªäºæ·±åº¦çš„è‡ªæˆ‘è§‰å¯Ÿã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢è¿™ä¸ªé—®é¢˜èƒŒåçš„æ·±å±‚å«ä¹‰ã€‚"
                    ];
                    
                    // æ ¹æ®ç”¨æˆ·æƒ…ç»ªçŠ¶æ€è°ƒæ•´å›å¤
                    let moodResponse = "";
                    switch(this.userMoodState) {
                        case 'anxious':
                            moodResponse = "æˆ‘æ„Ÿå—åˆ°æ‚¨å†…å¿ƒçš„ä¸å®‰ã€‚æ·±å‘¼å¸ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ…¢æ…¢æ¢ç´¢è¿™ä¸ªé—®é¢˜ã€‚";
                            break;
                        case 'sad':
                            moodResponse = "æˆ‘ç†è§£æ‚¨æ­¤åˆ»çš„å¿ƒæƒ…ã€‚æœ‰æ—¶å€™ï¼Œå€¾è¯‰æœ¬èº«å°±æ˜¯ç–—æ„ˆçš„å¼€å§‹ã€‚";
                            break;
                        case 'angry':
                            moodResponse = "æˆ‘æ˜ç™½æ‚¨çš„æ„¤æ€’å’ŒæŒ¡æŠ˜ã€‚è¿™äº›æƒ…ç»ªæ˜¯å®Œå…¨å¯ä»¥ç†è§£çš„ã€‚";
                            break;
                        case 'hopeful':
                            moodResponse = "æ‚¨çš„ç§¯ææ€åº¦è®©äººé¼“èˆï¼è¿™ç§æ­£å‘èƒ½é‡ä¼šå¸®åŠ©æ‚¨å®ç°ç›®æ ‡ã€‚";
                            break;
                        case 'confused':
                            moodResponse = "è¿·èŒ«æ˜¯æˆé•¿çš„ä¼™ä¼´ã€‚è®©æˆ‘ä»¬ä¸€èµ·ç†æ¸…æ€è·¯ã€‚";
                            break;
                        default:
                            moodResponse = "";
                    }
                    
                    // ç»„åˆå›å¤
                    const baseResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
                    
                    if (contextualInsight && moodResponse) {
                        return contextualInsight + " " + moodResponse + " " + baseResponse;
                    } else if (moodResponse) {
                        return moodResponse + " " + baseResponse;
                    } else if (contextualInsight) {
                        return contextualInsight + " " + baseResponse;
                    }
                    
                    return baseResponse;
                }
            };
            
            // è·å–DOMå…ƒç´ 
            const drawCardBtn = document.getElementById('drawCard');
            const buyReportBtn = document.getElementById('buyReport');
            const shareReadingBtn = document.getElementById('shareReading');
            const cardIcon = document.querySelector('.card-icon');
            const cardName = document.querySelector('.card-name');
            const cardDescription = document.querySelector('.card-description');
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendMessageBtn = document.getElementById('sendMessage');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const authModal = document.getElementById('authModal');
            const modalTitle = document.getElementById('modalTitle');
            const authForm = document.getElementById('authForm');
            const closeBtn = document.querySelector('.close');
            const spreadOptions = document.querySelectorAll('.spread-option');
            
            // å½“å‰æŠ½ä¸­çš„ç‰Œ
            let currentCard = null;
            let isLoginMode = true;
            
            // æŠ½å–å¡”ç½—ç‰Œ
            drawCardBtn.addEventListener('click', function() {
                const randomIndex = Math.floor(Math.random() * tarotCards.length);
                currentCard = tarotCards[randomIndex];
                
                // æ›´æ–°å¡ç‰‡æ˜¾ç¤º
                cardIcon.innerHTML = `<i class="${currentCard.icon}"></i>`;
                cardName.textContent = currentCard.name;
                cardDescription.textContent = currentCard.description;
                
                // æ·»åŠ ä¸€å¼ AIæ¬¢è¿æ¶ˆæ¯
                addChatMessage("æˆ‘æŠ½åˆ°äº†" + currentCard.name + "ç‰Œï¼Œæ‚¨å¯ä»¥ä¸ºæˆ‘è§£è¯»ä¸€ä¸‹å—ï¼Ÿ", "user");
                
                // AIå›å¤
                setTimeout(function() {
                    addChatMessage("æ‚¨æŠ½åˆ°äº†" + currentCard.name + "ç‰Œï¼Œè¿™å¼ ç‰Œè¡¨æ˜" + currentCard.description + "ä»ä¸œæ–¹æ™ºæ…§çš„è§’åº¦ï¼Œè¿™æé†’æˆ‘ä»¬è¦ä¿æŒå†…å¿ƒçš„å¹³è¡¡ä¸å’Œè°ã€‚", "ai");
                }, 1000);
            });
            
            // è´­ä¹°æ·±åº¦æŠ¥å‘Š
            buyReportBtn.addEventListener('click', function() {
                if (!currentCard) {
                    alert('è¯·å…ˆæŠ½å–ä¸€å¼ å¡”ç½—ç‰Œï¼');
                    return;
                }
                
                alert('æ·±åº¦æŠ¥å‘Šå·²è§£é”ï¼\n\n' + currentCard.name + 'ç‰Œå®Œæ•´è§£è¯»ï¼š\n' + currentCard.fullDescription);
                
                // æ·»åŠ ä¸€å¼ AIæ¶ˆæ¯
                addChatMessage("æˆ‘å·²è§£é”" + currentCard.name + "ç‰Œçš„æ·±åº¦æŠ¥å‘Šï¼Œéå¸¸æ„Ÿè°¢ï¼", "user");
                
                // AIå›å¤
                setTimeout(function() {
                    addChatMessage("æ„Ÿè°¢æ‚¨è§£é”æ·±åº¦æŠ¥å‘Šï¼" + currentCard.name + "ç‰Œçš„æ›´æ·±å±‚æ„ä¹‰æ˜¯ï¼š" + currentCard.fullDescription + "å»ºè®®æ‚¨å°†è¿™äº›æ™ºæ…§åº”ç”¨åˆ°æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œè§‚å¯Ÿå†…å¿ƒçš„å˜åŒ–ã€‚", "ai");
                }, 1000);
            });
            
            // åˆ†äº«è§£è¯»
            shareReadingBtn.addEventListener('click', function() {
                if (!currentCard) {
                    alert('è¯·å…ˆæŠ½å–ä¸€å¼ å¡”ç½—ç‰Œï¼');
                    return;
                }
                
                if (navigator.share) {
                    navigator.share({
                        title: 'æˆ‘çš„å¡”ç½—ç‰Œè§£è¯»',
                        text: 'æˆ‘åˆšåˆšæŠ½åˆ°äº†ä¸€å¼ ' + currentCard.name + 'ç‰Œï¼Œå¿«æ¥æŸ¥çœ‹æˆ‘çš„å¡”ç½—è§£è¯»ï¼',
                        url: window.location.href
                    })
                    .then(() => console.log('åˆ†äº«æˆåŠŸ'))
                    .catch((error) => console.log('åˆ†äº«å¤±è´¥', error));
                } else {
                    // å¤‡ç”¨åˆ†äº«æ–¹å¼
                    alert('åˆ†äº«åŠŸèƒ½åœ¨å½“å‰æµè§ˆå™¨ä¸­ä¸å¯ç”¨ï¼Œæ‚¨å¯ä»¥å¤åˆ¶é“¾æ¥åˆ†äº«ç»™æœ‹å‹ï¼š' + window.location.href);
                }
            });
            
            // å¿«é€Ÿå›å¤å»ºè®®ï¼ˆæ›´æ¸©æŸ”æ™ºæ…§ï¼‰
            const quickReplies = [
                "ğŸŒ¸ æœ€è¿‘æ„Ÿåˆ°å¿ƒæƒ…æœ‰äº›ç¹é‡ï¼Œæƒ³æ‰¾åˆ°å†…å¿ƒçš„å¹³é™",
                "ğŸŒ± å·¥ä½œå’Œç”Ÿæ´»è®©æˆ‘æ„Ÿåˆ°ç„¦è™‘ï¼Œéœ€è¦ä¸€äº›æ™ºæ…§å’ŒæŒ‡å¼•",
                "ğŸŒ™ å¯¹æœªæ¥çš„æ–¹å‘æ„Ÿåˆ°è¿·èŒ«ï¼Œå¸Œæœ›æ‰¾åˆ°æ¸…æ™°çš„è·¯å¾„",
                "ğŸŒ¿ æƒ³å­¦ä¹ å¦‚ä½•å¸å¼•ç¾å¥½çš„äº‹ç‰©è¿›å…¥æˆ‘çš„ç”Ÿæ´»",
                "ğŸ¦‹ æ¸´æœ›å¿ƒçµæˆé•¿ï¼Œæƒ³äº†è§£æ›´æ·±å±‚çš„è‡ªæˆ‘",
                "ğŸŒ åœ¨äººé™…å…³ç³»ä¸­é‡åˆ°æŒ‘æˆ˜ï¼Œå¸Œæœ›æ‰¾åˆ°å’Œè°çš„æ–¹å¼"
            ];
            
            // åˆ›å»ºå¿«é€Ÿå›å¤æŒ‰é’®
            function createQuickReplyButtons() {
                const quickReplyContainer = document.createElement('div');
                quickReplyContainer.className = 'quick-replies';
                quickReplyContainer.style.cssText = `
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                    margin: 15px 0;
                    padding: 10px;
                    background: rgba(163, 201, 184, 0.1);
                    border-radius: 10px;
                    border: 1px dashed #a3c9b8;
                `;
                
                const title = document.createElement('div');
                title.textContent = 'ğŸ’¡ å¿«é€Ÿæé—®ï¼š';
                title.style.cssText = `
                    width: 100%;
                    font-size: 0.9rem;
                    color: #3a7a6d;
                    margin-bottom: 5px;
                    font-weight: 500;
                `;
                quickReplyContainer.appendChild(title);
                
                quickReplies.forEach(reply => {
                    const button = document.createElement('button');
                    button.textContent = reply;
                    button.style.cssText = `
                        background: rgba(255, 255, 255, 0.9);
                        border: 1px solid #b8d5c7;
                        border-radius: 15px;
                        padding: 6px 12px;
                        font-size: 0.85rem;
                        color: #3a7a6d;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-family: 'Noto Serif SC', serif;
                    `;
                    
                    button.addEventListener('mouseenter', function() {
                        this.style.background = '#4a8e7f';
                        this.style.color = 'white';
                        this.style.transform = 'translateY(-1px)';
                    });
                    
                    button.addEventListener('mouseleave', function() {
                        this.style.background = 'rgba(255, 255, 255, 0.9)';
                        this.style.color = '#3a7a6d';
                        this.style.transform = 'translateY(0)';
                    });
                    
                    button.addEventListener('click', function() {
                        userInput.value = reply;
                        sendMessage();
                    });
                    
                    quickReplyContainer.appendChild(button);
                });
                
                return quickReplyContainer;
            }
            
            // æ‰“å­—æ•ˆæœæ¨¡æ‹Ÿ
            function addTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.classList.add('message', 'ai-message', 'typing-indicator');
                typingDiv.innerHTML = `
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                    ç–—æ„ˆå¸ˆæ­£åœ¨è¾“å…¥...
                `;
                
                // æ·»åŠ æ‰“å­—åŠ¨ç”»æ ·å¼
                const style = document.createElement('style');
                style.textContent = `
                    .typing-indicator {
                        opacity: 0.7;
                        font-style: italic;
                    }
                    .typing-dots {
                        display: inline-block;
                        margin-right: 8px;
                    }
                    .typing-dots span {
                        display: inline-block;
                        width: 4px;
                        height: 4px;
                        border-radius: 50%;
                        background: #4a8e7f;
                        margin: 0 1px;
                        animation: typingDots 1.4s infinite;
                    }
                    .typing-dots span:nth-child(2) {
                        animation-delay: 0.2s;
                    }
                    .typing-dots span:nth-child(3) {
                        animation-delay: 0.4s;
                    }
                    @keyframes typingDots {
                        0%, 60%, 100% {
                            transform: translateY(0);
                            opacity: 0.3;
                        }
                        30% {
                            transform: translateY(-10px);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return typingDiv;
            }
            
            // å‘é€æ¶ˆæ¯åŠŸèƒ½
            function sendMessage() {
                const message = userInput.value.trim();
                if (message) {
                    addChatMessage(message, "user");
                    userInput.value = '';
                    
                    // æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
                    const typingIndicator = addTypingIndicator();
                    
                    // æ¨¡æ‹Ÿæ€è€ƒæ—¶é—´
                    const thinkingTime = Math.random() * 2000 + 1500; // 1.5-3.5ç§’
                    
                    setTimeout(function() {
                        // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨
                        typingIndicator.remove();
                        
                        // ç”Ÿæˆæ™ºèƒ½å›å¤
                        const aiResponse = aiTherapist.generateResponse(message);
                        
                        // æ¨¡æ‹Ÿé€å­—æ‰“å­—æ•ˆæœ
                        addChatMessageWithTypeEffect(aiResponse, "ai");
                    }, thinkingTime);
                }
            }
            
            // å‘é€æ¶ˆæ¯
            sendMessageBtn.addEventListener('click', sendMessage);
            
            // æŒ‰å›è½¦å‘é€æ¶ˆæ¯
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessageBtn.click();
                }
            });
            
            // æ·»åŠ èŠå¤©æ¶ˆæ¯ï¼ˆå³æ—¶æ˜¾ç¤ºï¼‰
            function addChatMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                messageDiv.textContent = text;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // æ·»åŠ èŠå¤©æ¶ˆæ¯ï¼ˆæ‰“å­—æ•ˆæœï¼‰
            function addChatMessageWithTypeEffect(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                
                chatMessages.appendChild(messageDiv);
                
                let index = 0;
                const typingSpeed = 30; // æ‰“å­—é€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
                
                function typeNextCharacter() {
                    if (index < text.length) {
                        messageDiv.textContent = text.substring(0, index + 1);
                        index++;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        setTimeout(typeNextCharacter, typingSpeed);
                    }
                }
                
                typeNextCharacter();
            }
            
            // ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
            loginBtn.addEventListener('click', function() {
                isLoginMode = true;
                modalTitle.textContent = 'ç™»å½•';
                authModal.style.display = 'block';
            });
            
            registerBtn.addEventListener('click', function() {
                isLoginMode = false;
                modalTitle.textContent = 'æ³¨å†Œ';
                authModal.style.display = 'block';
            });
            
            closeBtn.addEventListener('click', function() {
                authModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target == authModal) {
                    authModal.style.display = 'none';
                }
            });
            
            authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (isLoginMode) {
                    // ç™»å½•é€»è¾‘
                    loginUser(email, password);
                } else {
                    // æ³¨å†Œé€»è¾‘
                    registerUser(email, password);
                }
            });
            
            function loginUser(email, password) {
                // æ¨¡æ‹Ÿç™»å½•è¿‡ç¨‹
                const users = JSON.parse(localStorage.getItem('tarotUsers')) || [];
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    alert('ç™»å½•æˆåŠŸï¼');
                    authModal.style.display = 'none';
                    // æ›´æ–°UIæ˜¾ç¤ºç”¨æˆ·å·²ç™»å½•
                    updateUIForLoggedInUser(user);
                } else {
                    alert('é‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼');
                }
            }
            
            function registerUser(email, password) {
                // æ¨¡æ‹Ÿæ³¨å†Œè¿‡ç¨‹
                const users = JSON.parse(localStorage.getItem('tarotUsers')) || [];
                
                if (users.some(u => u.email === email)) {
                    alert('è¯¥é‚®ç®±å·²æ³¨å†Œï¼');
                    return;
                }
                
                users.push({ email, password, readings: [] });
                localStorage.setItem('tarotUsers', JSON.stringify(users));
                
                alert('æ³¨å†ŒæˆåŠŸï¼');
                authModal.style.display = 'none';
            }
            
            function updateUIForLoggedInUser(user) {
                // æ›´æ–°UIæ˜¾ç¤ºç”¨æˆ·å·²ç™»å½•
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                
                const userMenu = document.createElement('div');
                userMenu.className = 'user-menu';
                userMenu.innerHTML = `
                    <span>æ¬¢è¿ï¼Œ${user.email}</span>
                    <button id="logoutBtn" class="btn btn-secondary">é€€å‡º</button>
                `;
                document.querySelector('.user-actions').appendChild(userMenu);
                
                document.getElementById('logoutBtn').addEventListener('click', function() {
                    localStorage.removeItem('currentUser');
                    window.location.reload();
                });
            }
            
            // ç‰Œé˜µé€‰æ‹©åŠŸèƒ½
            spreadOptions.forEach(option => {
                option.addEventListener('click', function() {
                    spreadOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    updateSpreadUI(this.dataset.spread);
                });
            });
            
            function updateSpreadUI(spreadType) {
                const tarotCards = document.querySelector('.tarot-cards');
                tarotCards.innerHTML = '';
                
                switch(spreadType) {
                    case 'single':
                        tarotCards.innerHTML = '<div class="mini-card">å•å¼ ç‰Œ</div>';
                        break;
                    case 'three':
                        tarotCards.innerHTML = `
                            <div class="mini-card">è¿‡å»</div>
                            <div class="mini-card">ç°åœ¨</div>
                            <div class="mini-card">æœªæ¥</div>
                        `;
                        break;
                    case 'celtic':
                        tarotCards.innerHTML = `
                            <div class="mini-card">1</div>
                            <div class="mini-card">2</div>
                            <div class="mini-card">3</div>
                            <div class="mini-card">4</div>
                            <div class="mini-card">5</div>
                            <div class="mini-card">6</div>
                            <div class="mini-card">7</div>
                            <div class="mini-card">8</div>
                            <div class="mini-card">9</div>
                            <div class="mini-card">10</div>
                        `;
                        break;
                }
            }
            
            // åˆå§‹åŒ–èŠå¤©ç³»ç»Ÿ
            function initializeChatSystem() {
                // åŠ è½½ç”¨æˆ·æ•°æ®
                aiTherapist.loadUserData();
                
                // åœ¨èŠå¤©è¾“å…¥åŒºåŸŸä¸Šæ–¹æ·»åŠ å¿«é€Ÿå›å¤æŒ‰é’®
                const chatInputDiv = document.querySelector('.chat-input');
                const quickReplyButtons = createQuickReplyButtons();
                chatInputDiv.parentNode.insertBefore(quickReplyButtons, chatInputDiv);
                
                // æ·»åŠ ä¸ªæ€§åŒ–æ¬¢è¿æ¶ˆæ¯
                setTimeout(() => {
                    let welcomeMessage = "ğŸŒ¿ ä½ å¯ä»¥ç‚¹å‡»ä¸Šæ–¹çš„æ¸©æŸ”æé—®ï¼Œæˆ–è€…è‡ªç”±åœ°åˆ†äº«ä½ çš„å¿ƒå£°ã€‚";
                    
                    // æ ¹æ®å†å²å¯¹è¯ä¸ªæ€§åŒ–æ¬¢è¿è¯­
                    if (aiTherapist.conversationHistory.length > 0) {
                        const lastConversation = aiTherapist.conversationHistory[aiTherapist.conversationHistory.length - 1];
                        const timeSinceLastChat = Date.now() - lastConversation.timestamp;
                        
                        if (timeSinceLastChat < 24 * 60 * 60 * 1000) { // 24å°æ—¶å†…
                            const greeting = aiTherapist.personality.greeting[Math.floor(Math.random() * aiTherapist.personality.greeting.length)];
                            welcomeMessage = `ğŸŒŸ ${greeting}ï¼Œæ¬¢è¿å›åˆ°æˆ‘ä»¬çš„å¿ƒçµç©ºé—´ã€‚æˆ‘ä»ç„¶è®°å¾—ä¸Šæ¬¡ä½ åˆ†äº«çš„å¿ƒå£°ï¼Œä»Šå¤©ä½ çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ`;
                        }
                        
                        // æ ¹æ®ç”¨æˆ·å…³æ³¨çš„ä¸»é¢˜æä¾›ä¸ªæ€§åŒ–å»ºè®®
                        if (aiTherapist.userPreferences.favoriteTopics.length > 0) {
                            const topics = aiTherapist.userPreferences.favoriteTopics;
                            if (topics.includes('career')) {
                                welcomeMessage += " ä½ çš„å·¥ä½œå’Œäº‹ä¸šæœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ";
                            } else if (topics.includes('love')) {
                                welcomeMessage += " ä½ çš„å¿ƒæƒ…å’Œæƒ…æ„Ÿç”Ÿæ´»è¿˜å¥½å—ï¼Ÿ";
                            } else if (topics.includes('family')) {
                                welcomeMessage += " ä½ å’Œå®¶äººçš„å…³ç³»è¿˜å’Œè°å—ï¼Ÿ";
                            }
                        }
                    }
                    
                    welcomeMessage += " æˆ‘ä¼šç”¨å¡”ç½—çš„å¤è€æ™ºæ…§å’Œä¸œæ–¹å“²å­¦çš„æ¸©æŸ”æ•™å¯¼ï¼Œé™ªä¼´ä½ åœ¨è¿™æ®µæ—…ç¨‹ä¸­æ‰¾åˆ°å±äºä½ çš„ç­”æ¡ˆã€‚";
                    
                    addChatMessageWithTypeEffect(welcomeMessage, "ai");
                }, 2500);
            }
            
            // å¯¹è¯ç®¡ç†åŠŸèƒ½
            document.getElementById('viewHistoryBtn')?.addEventListener('click', function() {
                if (aiTherapist.conversationHistory.length === 0) {
                    alert('æ‚¨è¿˜æ²¡æœ‰ä»»ä½•å¯¹è¯è®°å½•ã€‚');
                    return;
                }
                
                let historyText = 'ğŸ“œ æ‚¨çš„å¯¹è¯å†å²ï¼š\n\n';
                aiTherapist.conversationHistory.slice(-10).forEach((conv, index) => {
                    const date = new Date(conv.timestamp).toLocaleString();
                    historyText += `${index + 1}. ${date}\n`;
                    historyText += `ğŸ’¬ æ‚¨: ${conv.user}\n`;
                    historyText += `ğŸ§˜ ç–—æ„ˆå¸ˆ: ${conv.ai.substring(0, 100)}...\n`;
                    historyText += `ğŸ˜Š æƒ…ç»ª: ${conv.mood}\n\n`;
                });
                
                alert(historyText);
            });
            
            document.getElementById('clearHistoryBtn')?.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¯¹è¯è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    aiTherapist.conversationHistory = [];
                    aiTherapist.userPreferences = {
                        favoriteTopics: [],
                        communicationStyle: 'balanced',
                        wisdomSource: 'mixed'
                    };
                    aiTherapist.saveUserData();
                    alert('å¯¹è¯è®°å½•å·²æ¸…ç©ºã€‚');
                }
            });
            
            document.getElementById('exportChatBtn')?.addEventListener('click', function() {
                if (aiTherapist.conversationHistory.length === 0) {
                    alert('æ²¡æœ‰å¯¹è¯è®°å½•å¯å¯¼å‡ºã€‚');
                    return;
                }
                
                let exportText = 'å¡”ç½—ç–—æ„ˆå¸ˆå¯¹è¯è®°å½•\n';
                exportText += '==================\n\n';
                
                aiTherapist.conversationHistory.forEach((conv, index) => {
                    const date = new Date(conv.timestamp).toLocaleString();
                    exportText += `å¯¹è¯ ${index + 1} - ${date}\n`;
                    exportText += `æƒ…ç»ªçŠ¶æ€: ${conv.mood}\n`;
                    exportText += `æ‚¨: ${conv.user}\n`;
                    exportText += `ç–—æ„ˆå¸ˆ: ${conv.ai}\n`;
                    exportText += '\n---\n\n';
                });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `å¡”ç½—ç–—æ„ˆå¸ˆå¯¹è¯è®°å½•_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                updateUIForLoggedInUser(JSON.parse(currentUser));
            }
        });
    </script>
</body>
</html>